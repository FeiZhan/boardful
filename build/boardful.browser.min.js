/*! boardful browser 2015-02-11 */
var BOARDFUL=BOARDFUL||new Object;BOARDFUL.CardUi=function(a,b){this.type="CardUi",this.instance=a,this.owner=b,this.visible=!1,BOARDFUL.Mngr.add(this),this.addListeners();new BOARDFUL.FileLoader(["src/browser/card.html","src/browser/card.css"],function(){})},BOARDFUL.CardUi.prototype.load=function(a,b){a=a||new Object,a.parent=a.parent||"";var c=this;$.get("src/browser/card.html",function(d){$("#"+BOARDFUL.Menu.Canvas+" "+a.parent).append(d).fadeIn("slow"),$("#"+BOARDFUL.Menu.Canvas+" "+a.parent+" .card:last").attr("id",c.id);var e=$("#"+BOARDFUL.Menu.Canvas+" #"+c.id);c.visible&&e.addClass("visible"),a.position&&e.css(a.position),e.find("h4").html(BOARDFUL.Mngr.get(c.instance).name);var f=BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(c.instance).game).owner).config.cards,g="resources/poker_back.jpg";f&&f.back&&(g=f.back),e.find(".back").attr("src",g);var h;e.draggable({revert:"invalid",start:function(){h=setInterval(function(){e.toggleClass("flip")},2e3)},drag:function(){},stop:function(){clearInterval(h),e.removeClass("flip")}}),e.hover(function(){!$(".boardful #detail").hasClass("active")},function(){$(".boardful #detail").hasClass("active")&&$(".boardful #detail").removeClass("active").fadeOut("fast")}),"function"==typeof b&&b(e)})},BOARDFUL.CardUi.prototype.move=function(a,b){var c=$("#"+BOARDFUL.Menu.Canvas+" #"+this.id);if(a=a||c,0==c.length){var d=this;this.load({position:{top:"50%",left:"80%"}},function(){d.move(a,b)})}else{var e={top:a.offset().top+a.height()/2-c.height()/2,left:a.offset().left+a.width()/2-c.width()/2},f=c.detach();$("#"+BOARDFUL.Menu.Canvas).append(f),c=$("#"+BOARDFUL.Menu.Canvas+" #"+this.id),c.offset(e);var g={top:b.position().top+b.height()/2-c.height()/2,left:b.position().left+b.width()/2-c.width()/2};c.animate(g,"slow",function(){var a=c.detach();b.append(a),c=$("#"+BOARDFUL.Menu.Canvas+" #"+this.id),c.css({top:"auto",left:"auto"})})}},BOARDFUL.CardUi.prototype.remove=function(){var a=$("#"+BOARDFUL.Menu.Canvas+" #"+this.id);a.css({position:"absolute"}),a.animate({top:"-=100px",left:"-=100px",height:"+=200px",width:"+=200px",opacity:0},"slow",function(){$(this).remove()})},BOARDFUL.CardUi.prototype.addListeners=function(){var a=this;BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).game).event_mngr.on("ShowCard",{level:"game",callback:function(b){a.show(b)},id:a.id})},BOARDFUL.CardUi.prototype.show=function(a){if(void 0===a||a.card==this.id||a.card==this.instance){this.visible=!0;var b=$("#"+BOARDFUL.Menu.Canvas+" #"+this.id);b.addClass("visible")}};var BOARDFUL=BOARDFUL||new Object;BOARDFUL.GameUi=function(a){this.type="GameUi",this.instance=a,BOARDFUL.Mngr.add(this),BOARDFUL.Command.owner=this.instance,this.addListeners(),$("#"+BOARDFUL.Menu.Canvas).empty();var b=this;$("#"+BOARDFUL.Menu.Canvas).hide().load("src/browser/game.html",function(){$(this).fadeIn("slow"),$("#"+BOARDFUL.Menu.Canvas+" #playerok").on("click",function(){if("userinput"==BOARDFUL.Mngr.get(b.instance).status)for(var a in b.player_list)"me"==BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(b.player_list[a]).instance).name&&BOARDFUL.Mngr.get(b.player_list[a]).playerOk()}),$("#"+BOARDFUL.Menu.Canvas+" #chat div").on("click",function(){$(this).toggleClass("disable")}),$("#"+BOARDFUL.Menu.Canvas+" #table").droppable({drop:function(a,c){b.dropCardOnTable(a,c,this)}})}),this.player_list=new Array;for(var c in BOARDFUL.Mngr.get(this.instance).player_list){var d=BOARDFUL.Mngr.get(this.instance).player_list[c],e=new BOARDFUL.PlayerUi(d,this.id).id;BOARDFUL.Mngr.get(d).ui=e,this.player_list.push(e)}new BOARDFUL.FileLoader(["src/browser/game.html","src/browser/game.css"],function(){})},BOARDFUL.GameUi.prototype.dropCardOnTable=function(a,b,c){if("userinput"==BOARDFUL.Mngr.get(this.instance).status){var d=$(b.draggable).detach();d.css({top:"auto",left:"auto"}),$(c).append(d)}},BOARDFUL.GameUi.prototype.addListeners=function(){var a=this;BOARDFUL.Mngr.get(this.instance).event_mngr.on("DealCardUi",{level:"game",callback:function(b){a.dealCardUi(b)},id:a.id}),BOARDFUL.Mngr.get(this.instance).event_mngr.on("PlaceCardOnTable",{level:"game",callback:function(b){a.placeCardOnTable(b)},id:a.id}),BOARDFUL.Mngr.get(this.instance).event_mngr.on("Discard",{level:"game",callback:function(b){a.discard(b)},id:a.id})},BOARDFUL.GameUi.prototype.dealCardUi=function(a){var b=new BOARDFUL.CardUi(a.card,this);BOARDFUL.Mngr.get(a.card).ui=b.id;var c;switch(BOARDFUL.Mngr.get(a.player).name){case"ai":c=$("#player_you .hand");break;case"me":default:b.visible=!0,c=$("#player_me .hand")}b.move($("#deck"),c)},BOARDFUL.GameUi.prototype.placeCardOnTable=function(a){for(var b in a.cards){var c=BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(a.cards[b]).ui);c.move(void 0,$("#table"))}},BOARDFUL.GameUi.prototype.discard=function(a){for(var b in a.cards)BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(a.cards[b]).ui).remove()};var BOARDFUL=BOARDFUL||new Object;BOARDFUL.Menu=BOARDFUL.Menu||new Object,BOARDFUL.Menu.Canvas="",BOARDFUL.Menu.run=function(a){BOARDFUL.Menu.Canvas=a,$("#"+BOARDFUL.Menu.Canvas).addClass("boardful"),$("#header #options").click(function(){$("#dialog").toggleClass("active")}),$("#header #sound").click(function(){$(this).toggleClass("disable")}),BOARDFUL.Menu.loadOptions(),BOARDFUL.Menu.loadMenu0()},BOARDFUL.Menu.loadOptions=function(){$("#dialog").empty(),$("#dialog").load("src/browser/options.html",function(){$("#dialog #options_debug").click(function(){$("#dialog > div").removeClass("active"),$("#dialog #options_l1_debug").addClass("active")}),$("#dialog #options_l1_debug li").click(function(){$("#dialog #options_l1_debug li").removeClass("active"),$(this).addClass("active");var a=$(this).attr("id"),b=new Array;switch(a){case"debug_logger":b=BOARDFUL.logger.list;break;case"debug_debugger":b=BOARDFUL.Debugger.list;break;case"debug_files":b=BOARDFUL.File.logger.list;break;case"debug_objects":b=BOARDFUL.Mngr.logger.list;break;case"debug_events":b=new Array;var c=BOARDFUL.Mngr.get(BOARDFUL.Menu.Selected);if(c){var d=BOARDFUL.Mngr.get(c.room_list[0]);if(d){var e=BOARDFUL.Mngr.get(d.game_list[0]);e&&(b=e.event_mngr.logger.list)}}break;case"debug_event_names":b=new Array;var c=BOARDFUL.Mngr.get(BOARDFUL.Menu.Selected);if(c){var d=BOARDFUL.Mngr.get(c.room_list[0]);if(d){var e=BOARDFUL.Mngr.get(d.game_list[0]);e&&(b=e.event_mngr.name_logger.list)}}break;default:b=new Array}$("#dialog #options_debug_log").empty();for(var f in b)$("#dialog #options_debug_log").append("<div>"+b[f].content+"</div>")})});new BOARDFUL.FileLoader(["src/browser/options.html","src/browser/options.css"],function(){})},BOARDFUL.Menu.loadMenu0=function(){$("#"+BOARDFUL.Menu.Canvas).empty(),$("#"+BOARDFUL.Menu.Canvas).hide().load("src/browser/menu0.html",function(){$(this).fadeIn("slow"),$("#"+BOARDFUL.Menu.Canvas+" #menu0_main #local").click(function(){BOARDFUL.Menu.loadMenu1()}),$("#"+BOARDFUL.Menu.Canvas+" #menu0_secondary #options").click(function(){$("#dialog").toggleClass("active")})});new BOARDFUL.FileLoader(["src/browser/menu0.html","src/browser/menu0.css"],function(){})},BOARDFUL.Menu.Selected=void 0,BOARDFUL.Menu.loadMenu1=function(){$("#"+BOARDFUL.Menu.Canvas).empty(),$("#"+BOARDFUL.Menu.Canvas).hide().load("src/browser/menu1.html",function(){$(this).fadeIn("slow"),$("#"+BOARDFUL.Menu.Canvas+" #ok").click(function(){if(void 0!==BOARDFUL.Menu.Selected){var a=BOARDFUL.Mngr.get(BOARDFUL.Menu.Selected);a.load(BOARDFUL.Menu.loadMenu2)}}),$("#"+BOARDFUL.Menu.Canvas+" #exit").click(function(){BOARDFUL.Menu.run(BOARDFUL.Menu.Canvas)});for(var a in BOARDFUL.BoardList){var b=BOARDFUL.Mngr.get(BOARDFUL.BoardList[a]);$("#"+BOARDFUL.Menu.Canvas+" #board_list ul").append('<li id="'+BOARDFUL.BoardList[a]+'">'+b.config.name+"</li>"),0==a&&(BOARDFUL.Menu.Selected=$("#"+BOARDFUL.Menu.Canvas+" #board_list ul li:last").attr("id"),$("#"+BOARDFUL.Menu.Canvas+" #board_list ul li:last").addClass("active"),$("#"+BOARDFUL.Menu.Canvas+" #description div").html(BOARDFUL.Mngr.get(BOARDFUL.Menu.Selected).config.description)),$("#"+BOARDFUL.Menu.Canvas+" #board_list ul li:last").click(function(){BOARDFUL.Menu.Selected=$(this).attr("id"),$("#"+BOARDFUL.Menu.Canvas+" #board_list li").removeClass("active"),$(this).addClass("active"),$("#"+BOARDFUL.Menu.Canvas+" #description div").html(BOARDFUL.Mngr.get(BOARDFUL.Menu.Selected).config.description)})}});new BOARDFUL.FileLoader(["src/browser/menu1.html","src/browser/menu1.css"],function(){})},BOARDFUL.Menu.loadMenu2=function(a){var b=BOARDFUL.Mngr.get(a);$("#"+BOARDFUL.Menu.Canvas).empty(),$("#"+BOARDFUL.Menu.Canvas).hide().load("src/browser/menu2.html",function(){$(this).fadeIn("slow"),$("#"+BOARDFUL.Menu.Canvas+" #ok").on("click",function(){var b=new BOARDFUL.Game(a);b.ui=new BOARDFUL.GameUi(b.id),b.run()}),$("#"+BOARDFUL.Menu.Canvas+" #exit").click(function(){BOARDFUL.Menu.run(BOARDFUL.Menu.Canvas)}),$("#"+BOARDFUL.Menu.Canvas+" #room_config li").on("click",function(){$("#"+BOARDFUL.Menu.Canvas+" #room_config li").removeClass("active"),$("#"+BOARDFUL.Menu.Canvas+" #room_config div").removeClass("active"),$(this).addClass("active"),$("#"+BOARDFUL.Menu.Canvas+" #room_config div#"+$(this).attr("id")).addClass("active")}),$("#"+BOARDFUL.Menu.Canvas+" #room_config #name").html(b.config.name),$("#"+BOARDFUL.Menu.Canvas+" #room_config #description2").html(b.config.description),$("#"+BOARDFUL.Menu.Canvas+" #user_list #players").append('<div class="user"><span>me</span></div>'),$("#"+BOARDFUL.Menu.Canvas+" #user_list #judges").append('<div class="user"><span>empty</span></div>'),$("#"+BOARDFUL.Menu.Canvas+" #user_list #audience").append('<div class="user"><span>empty</span></div>');for(var c=1;c<b.config.players[0];++c)$("#"+BOARDFUL.Menu.Canvas+" #user_list #players").append('<div class="user"><span>empty</span></div>');$("#"+BOARDFUL.Menu.Canvas+" #user_list .user").on("click",function(){$("#"+BOARDFUL.Menu.Canvas+" #user_list .user").removeClass("active"),$(this).addClass("active")});for(var c in b.config.options){$("#"+BOARDFUL.Menu.Canvas+" #room_config").append('<div id="'+c+'"></div>'),$("#"+BOARDFUL.Menu.Canvas+" #room_config #"+c).append("<span>"+c+"</span><select></select>");for(var d in b.config.options[c].value)$("#"+BOARDFUL.Menu.Canvas+" #room_config #"+c+" select").append('<option value="'+b.config.options[c].value[d]+'">'+b.config.options[c].value[d]+"</option>")}});new BOARDFUL.FileLoader(["src/browser/menu2.html","src/browser/menu2.css"],function(){})};var BOARDFUL=BOARDFUL||new Object;BOARDFUL.PlayerUi=function(a,b){this.type="PlayerUi",this.instance=a,this.owner=b,BOARDFUL.Mngr.add(this),this.canvas="";var c;switch(BOARDFUL.Mngr.get(this.instance).name){case"ai":c="src/browser/player_you.html",this.canvas="player_you";break;case"me":default:c="src/browser/player_me.html",this.canvas="player_me"}this.addListeners(),this.play_card_arg=void 0,$.get(c,function(a){$("#"+BOARDFUL.Menu.Canvas).append(a).fadeIn("slow")});new BOARDFUL.FileLoader(["src/browser/player_me.html","src/browser/player_you.html","src/browser/player.css"],function(){})},BOARDFUL.PlayerUi.prototype.playerOk=function(){if("me"==BOARDFUL.Mngr.get(this.instance).name&&"userinput"==BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).owner).status&&void 0!==this.play_card_arg){var a=new Array;if($("#"+BOARDFUL.Menu.Canvas+" #table .card").each(function(){var b=parseInt($(this).attr("id")),c=BOARDFUL.Mngr.get(b).instance;"me"==BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(c).owner).owner).name&&a.push(c)}),a.length==this.play_card_arg.number){var b=new BOARDFUL.Event({name:"PlaceCardOnTable",source:this.instance,source_event:this.play_card_arg.source_event,player:this.instance,cards:a});BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).owner).event_mngr.front(b.id),BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).owner).status="run"}}},BOARDFUL.PlayerUi.prototype.addListeners=function(){var a=this;BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).owner).event_mngr.on("PlayCardUi",{level:"game",callback:function(b){a.playCardUi(b)},id:a.id}),BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).owner).event_mngr.on("ChangePlayerValueUi",{level:"game",callback:function(b){a.changePlayerValueUi(b)},id:a.id})},BOARDFUL.PlayerUi.prototype.playCardUi=function(a){a.player==this.instance&&(this.play_card_arg=a,BOARDFUL.Mngr.get(BOARDFUL.Mngr.get(this.instance).owner).status="userinput")},BOARDFUL.PlayerUi.prototype.changePlayerValueUi=function(a){if(a.player==this.instance){var b=$("#"+this.canvas+" .head #"+a.target+" span"),c=parseInt(b.html());b.html(c+a.value)}};